var PaypalExpressCheckout={primaryCssClassName:'jetpack-simple-payments',messageCssClassName:'jetpack-simple-payments-purchase-message',wpRestAPIHost:'https://public-api.wordpress.com',wpRestAPIVersion:'/wpcom/v2',getEnvironment:function(){if(localStorage&&localStorage.getItem&&localStorage.getItem('simple-payments-env')==='sandbox'){return 'sandbox';}
return 'production';},getCreatePaymentEndpoint:function(blogId){return(PaypalExpressCheckout.wpRestAPIHost+
PaypalExpressCheckout.wpRestAPIVersion+
'/sites/'+
blogId+
'/simple-payments/paypal/payment');},getExecutePaymentEndpoint:function(blogId,paymentId){return(PaypalExpressCheckout.wpRestAPIHost+
PaypalExpressCheckout.wpRestAPIVersion+
'/sites/'+
blogId+
'/simple-payments/paypal/'+
paymentId+
'/execute');},getNumberOfItems:function(field,enableMultiple){if(enableMultiple!=='1'){return 1;}
var numberField=document.getElementById(field);if(!numberField){return 1;}
var number=Number(numberField.value);if(isNaN(number)){return 1;}
return number;},getMessageContainer:function(domId){return document.getElementById(domId+'-message-container');},showMessage:function(message,domId,isError){var domEl=PaypalExpressCheckout.getMessageContainer(domId);var cssClasses=PaypalExpressCheckout.messageCssClassName+' show ';cssClasses+=isError?'error':'success';setTimeout(function(){domEl.innerHTML=message;domEl.setAttribute('class',cssClasses);},1000);},showError:function(message,domId){PaypalExpressCheckout.showMessage(message,domId,true);},processErrorMessage:function(errorResponse){var error=errorResponse?errorResponse.responseJSON:null;var defaultMessage='There was an issue processing your payment.';if(!error){return '<p>'+defaultMessage+'</p>';}
if(error.additional_errors){var messages=[];error.additional_errors.forEach(function(additionalError){if(additionalError.message){messages.push('<p>'+additionalError.message.toString()+'</p>');}});return messages.join('');}
return '<p>'+(error.message||defaultMessage)+'</p>';},processSuccessMessage:function(successResponse){var message=successResponse.message;var defaultMessage='Thank you. Your purchase was successful!';if(!message){return '<p>'+defaultMessage+'</p>';}
return '<p>'+message+'</p>';},cleanAndHideMessage:function(domId){var domEl=PaypalExpressCheckout.getMessageContainer(domId);domEl.setAttribute('class',PaypalExpressCheckout.messageCssClassName);domEl.innerHTML='';},renderButton:function(blogId,buttonId,domId,enableMultiple){var env=PaypalExpressCheckout.getEnvironment();if(!paypal){throw new Error('PayPal module is required by PaypalExpressCheckout');}
var buttonDomId=domId+'_button';paypal.Button.render({env:env,commit:true,style:{label:'pay',shape:'rect',color:'silver',size:'responsive',fundingicons:true,},payment:function(){PaypalExpressCheckout.cleanAndHideMessage(domId);var payload={number:PaypalExpressCheckout.getNumberOfItems(domId+'_number',enableMultiple),buttonId:buttonId,env:env,};return new paypal.Promise(function(resolve,reject){jQuery.post(PaypalExpressCheckout.getCreatePaymentEndpoint(blogId),payload).done(function(paymentResponse){if(!paymentResponse){PaypalExpressCheckout.showError(PaypalExpressCheckout.processErrorMessage(),domId);return reject(new Error('server_error'));}
resolve(paymentResponse.id);}).fail(function(paymentError){var paymentErrorMessage=PaypalExpressCheckout.processErrorMessage(paymentError);PaypalExpressCheckout.showError(paymentErrorMessage,domId);var code=paymentError.responseJSON&&paymentError.responseJSON.code?paymentError.responseJSON.code:'server_error';reject(new Error(code));});});},onAuthorize:function(onAuthData){var payload={buttonId:buttonId,payerId:onAuthData.payerID,env:env,};return new paypal.Promise(function(resolve,reject){jQuery.post(PaypalExpressCheckout.getExecutePaymentEndpoint(blogId,onAuthData.paymentID),payload).done(function(authResponse){if(!authResponse){PaypalExpressCheckout.showError(PaypalExpressCheckout.processErrorMessage(),domId);return reject(new Error('server_error'));}
PaypalExpressCheckout.showMessage(PaypalExpressCheckout.processSuccessMessage(authResponse),domId);resolve();}).fail(function(authError){var authErrorMessage=PaypalExpressCheckout.processErrorMessage(authError);PaypalExpressCheckout.showError(authErrorMessage,domId);var code=authError.responseJSON&&authError.responseJSON.code?authError.responseJSON.code:'server_error';reject(new Error(code));});});},},buttonDomId);},};